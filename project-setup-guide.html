<!DOCTYPE html>
<html>
<head style="background-color:beige">
  <title>Presto Query Project Setup Guide</title>
  <h2 style="color:chocolate">Server-side Project Setup Guide</h2>
  <br>
  <a href="#ch1">1. System Requirements</a></br>
  <a href="#ch2">2. Installing Git And Clone the project</a></br>
  <a href="#ch3">3. Project Basic environments setup</a></br>
  <a href="#ch4">4. Environments that needs to be configured Manually</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch1">1). Configure Java Environment Variables</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch2">2). Configure MySQL</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch3">3). Configure project config file</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch4">4). Add priviledge to project folder</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch5">5). Enable start-server and stop-server scripts</a></br>
  &nbsp&nbsp&nbsp&nbsp<a href="#sch6">6). Configure the web client</a></br>
  <a href="#ch5">5. Build the project by using maven</a></br>
  <a href="#ch6">6. launch the server</a></br>
  <a href="#ch7">7. check the web client</a></br>
  <hr></br>
</head>
<body style="background-color:beige">
  <h3 style="color:orange" id="ch1">1. System Requirements</h3></br>
  To successfully build and run the project, you need the following:</br>
  <p style="color:blue">
    1). A 64 bit linux system.</br>
    2). Oracle java 8.</br>
    </p>
    To follow this guide, you'd better use a system with apt-get like ubuntu.</br>
    In center OS and Redhat, commands are different, especially when installing java8.</br>
    <a href="https://www.digitalocean.com/community/tutorials/how-to-install-java-on-centos-and-fedora">(See this for more information on installing oracle jdk 8.)</a></br>
    </br>
  <h3 style="color:orange" id="ch2">2. Installing Git And Clone the project</h3></br>
  To download the project, we need to install git first using this command:</br>
  <p style="color:blue">
    sudo apt-get install git
    </p>
    After installation, we can begin to clone our project into the server machine.</br>
    By default, we place the project into /opt/project folder.
   <p style="color:blue">
    cd /opt </br>
    sudo mkdir project</br>
    cd project</br>
    sudo git clone https://github.com/infsci2711/MultiDBs-Query-Server.git</br>
    </p>
    </br> 
    
  <h3 style="color:orange" id="ch3">3. Project Basic environments setup</h3></br>
  We now download all dependencies and initialize the database of the project with the setup.sh script:</br>
  <p style="color:red">When installing MySQL, please use <b>'proot'</b> as password of root user. Later you may change it.</p>
  <p style="color:blue">
    cd MultiDBs-Query-Server</br>
    sudo chmod +x ./setup.sh</br>
    ./setup.sh</br>
    
    </p>
    Follow all setup guides in the console.
    <p style="color:gray">What does the script do?</br></br>
    First, it installed java 8.<br>
    Second, it installed maven, mysql, and nginx.<br>
    Third, it made a directory for presto logs.<br>
    Finally, it initialized the database.</p></br>
    
  <h3 style="color:orange" id="ch4">4. Environments that needs to be configured Manually</h3></br>
  We now have to configure some environments manually:</br>
  <p style="color:red" id="sch1">1). Configure Java Environment Variables</p>
  <p style="color:blue">
    sudo nano /etc/profile</br></p>
    <p style="color:red">use down arrow to go to the end of the file, press enter<br>
    Add the following lines:
    </p>
    <p style="color:DodgerBlue">
      Path=$PATH:/usr/lib/jvm/java-8-oracle/bin<br>
      export JAVA_Home=/usr/lib/jvm/java-8-oracle<br>
      export CLASSPATH=$JAVA_HOME/lib:.<br>
    </p>
    <p style="color:red">close the file by ctrl+x, follow the guide to save the file.<br>
    Then run the following command in terminal:
    </p>    
    <p style="color:blue">
    source /etc/profile</br>
    </p>
  <p style="color:red" id="sch2">2). Configure MySQL</p>
  <p style="color:blue">
    sudo nano /etc/mysql/my.cnf</br></p>
    <p style="color:red">use down arrow to search for [client]<br>
    Add the following line under [client]:
    </p>
    <p style="color:DodgerBlue">
      default-character-set = utf8
    </p>
    <p style="color:red">use down arrow to search for [mysqld]. And just somw lines below, find "bind-address"<br>
    Change to the following:
    </p>
    <p style="color:DodgerBlue">
      bind-address = 0.0.0.0
    </p>   
    <p style="color:red">close the file by ctrl+x, follow the guide to save the file.<br>
    Then run <b>either of</b> the following command in terminal:
    </p>    
    <p style="color:blue">
    sudo service mysql restart</br>
    sudo /etc/init.d/mysql restart
    </p>
    <p style="color:red" id="sch3">3). Configure project config file</p>
    <p style="color:blue">
    cd /opt/project/MultiDBs-Query-Server/MultiDBsQueryServerAPI/src/main/resources</br>
    sudo nano config.properties</br></p>
    <p style="color:red">change the following to correct value:</br></br>
    (e.g. metastore.rest.base = http://54.152.26.131:7654)
    </p>
    <p style="color:DodgerBlue">
      metastore.rest.base = (url of metastore project)<br>
    </p>
    <p style="color:gray">What does parameters mean in this file?<br></br>
    "port" is the port you are going to use for the server<br>
    "metastore.rest.base" is the base url of metastore project<br>
    "metastore.rest.getAllDatasources" is the path after "metastore.rest.base" which will provide all datasources list<br>
    "metastore.rest.addDatasource" is the path after "metastore.rest.base" which provides the register restful api</br>
    "presto.root" is the root folder of presto server</p>
    
    <p style="color:red" id="sch4">4). Add priviledge to project folder</br>(replace the username with your server login username)</p>
    <p style="color:blue">
    cd /opt/</br>
    sudo chown -R username:username project</br></p></br>
    
    <p style="color:red" id="sch5">5). Enable start-server and stop-server scripts</p>
    <p style="color:blue">
    cd /opt/project/MultiDBs-Query-Server/</br>
    sudo chmod +x ./start-servers.sh</br>
    sudo chmod +x ./stop-servers.sh</br>
    </p></br>
    
    <p style="color:red" id="sch6">6). Configure the web client</p>
    <p style="color:blue">
    cd /usr/share/nginx</br>
    sudo rm -R html</br>
    sudo ln -sv /opt/project/MultiDBs-Query-WebClient html</br>
    cd /opt/project/MultiDBs-Query-WebClient/javascripts/knockout_models</br>
    sudo nano global.js</br></p>
    <p style="color:red">change the following to correct value:</br></br>
    (e.g. var restBaseUrl = "http://54.174.80.167:7654/";
    </br>var metastoreGetDataSourcesUrl = "http://54.152.26.131:7654/datasources";)
    </p>
    <p style="color:DodgerBlue">
      var restBaseUrl = "http://(your ip address):(your server port,default 7654)/";</br>
      var metaStoreGetDataSourcesURL =  "http://(metastore ip address):(metastore server port,default 7654)/datasources";</br>
    </p></br>
    
    <h3 style="color:orange" id="ch5">5. Build the project by using maven</h3></br>
    Run the following:</br>
    <p style="color:blue">
    cd /opt/project/MultiDBs-Utils<br>
    mvn install<br>
    cd /opt/project/MultiDBs-Query-Server<br>
    mvn install<br>
    </p> </br>
    
    <h3 style="color:orange" id="ch6">6. launch the server</h3></br>
    Run the following:</br>
    <p style="color:blue">
    cd /opt/project/MultiDBs-Query-Server<br>
    ./start-servers.sh<br>
    </p>
    <p style="color:gray">You can also stop the server by running:</br>
    ./stop-servers.sh</br></p></br>
    
    <h3 style="color:orange" id="ch7">7. check the web client</h3></br>
    Access your server's url by the ip address of your server.</br>
    
    </br></br>
</body>
</html>
