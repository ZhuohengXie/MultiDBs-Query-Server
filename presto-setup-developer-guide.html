<html>
<head>
<style>
table, th, td {
    border: 1px solid black;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
}
</style>
<h2 style="color:blue">This is a guide for *presto users* to set up presto on ubuntu 12+ LTS x64</h2>
</head>
<body>
</br>
<h3 style="color:red">
NOTE that presto-server-0.97 has already been embedded in this github project.</br>
Just make sure the node.data-dir= in /presto-server-0.97/etc/node.properties file is pointing to</br>
a valid folder. (See Chapter2 for more description.) If you do not need more configuration, then</br>
you can simply use presto without reading the following.</br></p>
<hr>
</h3>
Quick Links:
<p>
       <a href="#ch1">1. About presto</a></br>
       <a href="#ch2">2. Downloading and configuring</a></br>
       <a href="#ch3">3. Add a Catalog</a></br>
       <a href="#ch4">4. Concepts, Terms and How to use</a></br>
       <a href="#ch5">5. About the jdbc</a></br>
</p>
<hr></br>
<h3 style="color:blue" id="ch1">Chapter1 About presto</h3>
<p>
Presto is a distributed query engine. It supports sql queries but it is not a database.
It only does query stuff. No actual data is stored on presto.
</p>
<a href="https://prestodb.io/docs/0.97/" target="_blank">see more at: https://prestodb.io/docs/0.97/</a></br>
<hr></br>
<h3 style="color:blue" id="ch2">Chapter2 Downloading and configuring</h3>
</br>
!!!!presto requires oracle java 8, and a 64-bit mac or linux</br>
to install java 8 on ubuntu, do the following in terminal:</br>
</br>
<p style="color:blue">
sudo add-apt-repository ppa:webupd8team/java</br>
sudo apt-get update</br>
sudo apt-get install oracle-java8-installer</br>
</p>
<p style="color:red">
!!!!note that when using presto adbc, the project should use “java-8-oracle” as JRE lib</br></p>
</br>
Now install presto-0.97.</br>
Download link:</br>
<a href="https://repo1.maven.org/maven2/com/facebook/presto/presto-server/0.97/presto-server-0.97.tar.gz" target="_blank">
	https://repo1.maven.org/maven2/com/facebook/presto/presto-server/0.97/presto-server-0.97.tar.gz</a></br>
</br>
Unpack it,then go to the where you unpacked. Now you should see presto-server-0.97 folder.</br>
First create a folder beside presto-server-0.97, named presto-bk.</br>
Go inside presto-server-0.97 folder, create another folder called etc, then go inside.</br>
create 4 files, each with the following content:</br>
(visually better see <a href="https://prestodb.io/docs/0.97/installation/deployment.html" target="_blank">
https://prestodb.io/docs/0.97/installation/deployment.html)</a></br>
</br>
<p style="color:blue">file 1: config.properties</br></p>
coordinator=true</br>
node-scheduler.include-coordinator=true</br>
http-server.http.port=8080</br>
task.max-memory=1GB</br>
discovery-server.enabled=true</br>
discovery.uri=http://localhost:8080</br>
</br>
<p style="color:blue">file 2: jvm.config</br></p>
-server</br>
-Xmx16G</br>
-XX:+UseConcMarkSweepGC</br>
-XX:+ExplicitGCInvokesConcurrent</br>
-XX:+CMSClassUnloadingEnabled</br>
-XX:+AggressiveOpts</br>
-XX:+HeapDumpOnOutOfMemoryError</br>
-XX:OnOutOfMemoryError=kill -9 %p</br>
-XX:ReservedCodeCacheSize=150M</br>
</br>
<p style="color:blue">file 3: log.properties</br></p>
com.facebook.presto=INFO</br>
</br>
<p style="color:blue">file 4: node.properties</br></p>
node.environment=production</br>
node.id=ffffffff-ffff-ffff-ffff-ffffffffffff</br>
node.data-dir=../../presto-bk</br>
</br>
<hr></br>
<h3 style="color:blue" id="ch3">Chapter3 Add a Catalog</h3>
</br>
Create a catalog folder under etc folder, then go inside.</br>
Here you store catalogs.</br>
</br>
Suppose you have mysql on local machine.</br>
Create a catalog file named whatever you want, say 'localhost.properties'.</br>
</br>
<p style="color:blue">catalog file: localhost.properties</br></p>
connector.name=mysql</br>
connection-url=jdbc:mysql://localhost:3306</br>
connection-user=USERNAME</br>
connection-password=PASSWORD</br>
</br>
Let's look at this catalog file.</br>
The file name (localhost.properties) contains the catalog name. So the catalog is called 'localhost'.</br>
Any catalog file is catalogName.properties. Catalog is actually a data source. </br>
This catalog file records how to access the data source for presto.</br>
</br>
The first line specifies the database type it is connecting to. </br>
For example, for oracle, it will be 'connector.name=oracle'.</br>
</br>
The second line specifies the ip and port of the data source.</br>
For example, there is a data source which is a mysql database on 192.268.0.1, port 3306.</br>
So this line should be 'connection-url=jdbc:mysql://192.168.0.1:3306'.</br>
</br>
The third and fourth line specifies the username and password to access the data source.</br>
Note that this is not the username for a single database, it is for the whole database server.</br>
</br>
Another problem is that presto does not automatically detect changes in /etc/catalog folder.</br>
So if you added a new catalog file to the server, you should restart the server to let presto load it.</br>
</br>
#note that you are now at folder 'presto-server-0.97'</br>
bin/launcher restart</br>
</br>
#note that bin/launcher is actually the server code, written in python.</br>
<hr></br>
<h3 style="color:blue" id="ch4">Chapter4 Concepts, Terms and How to use</h3>
</br>
The following shows what the term in presto means.</br></br>
<table>
	<tr>		
		<th>presto</th><th>urual term</th>
	</tr>		
	<tr>
		<td>catalog</td><td>datasource,server</td>
	</tr>
	<tr>
		<td>schema</td><td>database</td>
	</tr>
</table>

</br>
Download the cli for presto here: </br>
<a href="https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/0.97/presto-cli-0.97-executable.jar" target="_blank">
	https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/0.97/presto-cli-0.97-executable.jar</a></br>
</br>
Place it in the presto-server-0.97 folder. Rename it as 'presto'. (so the '.jar' is also removed.)</br>
</br>
#note that you should now be at folder 'presto-server-0.97'</br></br>
launch terminal, run:</br>
<p style="color:blue">sudo chmod +x ./presto</p>
First, start(restart the server):</br>
<p style="color:blue">bin/launcher restart</p>
Then, run presto cli with command:</br>
<p style="color:blue">./presto</p>
Presto's cli command interface works like the following:</br>
<p style="color:blue">./presto --server serverIP:8080 --catalog catalogName --schema databaseName</br>
</br>
All parameters can be empty, but if you specify schema, you should specify catalog first.</br></p>
No other problems otherwise.</br>
</br>
</br>
To explore presto and run queries:</br>
(suppose you run the presto cli with no parameters; remember that a ';' is required in cli after sql statement.)</br>
(you can view the execution status by visiting http://localhost:8080/)</br>
Suppose we have one datasource(catalog) called 'localhost'. There are two databases each containing a table.</br>
The whole structure should be like this.</br>
</br>
-localhost</br>
&nbsp&nbsp-db1</br>
&nbsp&nbsp&nbsp&nbsp        -table1</br>
&nbsp&nbsp    -db2</br>
&nbsp&nbsp&nbsp&nbsp        -table2</br>
</br>
#to show all catalogs we have, run:</br>
<p style="color:blue">show catalogs;</p>
#should return</br>
---------------</br>
catalog</br>
---------------</br>
localhost</br>
</br>
#to show all databases within one catalog:</br>
<p style="color:blue">show schemas from catalog;</p>
#should return</br>
-----------------</br>
schema</br>
-----------------</br>
db1</br>
db2</br>
-----------------</br>
</br>
#to show tables in a database, e.g. show tables in database 'db1'</br>
<p style="color:blue">show tables from localhost.db1;</p>
#should return:</br>
---------------</br>
table</br>
---------------</br>
table1</br>
---------------</br>
</br>
(Here note that as you logged in with no parameters, you should specify catalogname.databasename.tablename to access the table.)</br>
</br>
#to show column information (usually it is useless unless you are only curious about the column names.)</br>
<p style="color:blue">describe local.db1.table1;</p>
<table>
	<tr>		
		<th>name</th><th>type</th><th>null</th>
	</tr>		
	<tr>
		<td>id</td><td>bigint</td><td>true</td>
	</tr>
</table>
</br>
</br>
And you can do your own sql queries. <p style="color:red">But here are things to be careful:</p>
<p style="color:red">
1. no inserts!</br>
2. no drops!</br>
3. use statement only works in the cli, it won't work in your java. If you use it, extract it and specify it in connection().</br>
</p>
<hr></br>
<h3 style="color:blue" id="ch5">Chapter5 About the jdbc</h3>
Don't do what is said on presto website. Just add presto-jdbc-0.97 as maven dependency in your project.</br>
</br>
These following connection string patterns are supported.</br>
<p style="color:blue">
jdbc:presto://host:port        (only specifies server)</br>
jdbc:presto://host:port/catalog    (restricts all things within a single catalog, ignore other catalogs)</br>
jdbc:presto://host:port/catalog/schema (limit all things inside a single database. won't see more.)</br>
</br>
</p>
The way your program (with a mysql database as real db storage) runs queries is like the following:</br>
<p style="color:blue">
1. Your program talks to presto jdbc, to get connection;</br>
2. Presto jdbc talks to presto-mysql connector. (A connector defines all supports for queries. Use, drop and insert not supported.)</br>
3. Presto-mysql connector uses mysql-jdbc to run queries.</br>
4. Connector sends results from mysql-jdbc to presto-jdbc;</br>
5. Your program gets the result.</br>
</p>

The usage of presto jdbc is pretty like mysql-jdbc. Note the following:</br>
<p style="color:blue">
1. Presto does not enable Batch update. So execute one SQL query at a time.</br>
2. Presto resultset cannot be iterated as you like. It is only serial, front to end.</br>
3. Use, drop and insert not supported.</br>
4. The sql string should not have ';'.</br>
</p>
<hr></br>
In my case, it is very good to have the environment set on the local machine so that you can test it at any time.</br>
To develop on your local machine, if you are using ubuntu or another linux system, I suggest you to install smartgithg.</br>
Smartgithg is a GUI git, like your Github client. Very convenient.</br>
All you need to do is to generate a ssh key from your github account, and give it to smartgithg.</br>
Before that, you'd better have used 'sudo apt-get install softwarename' to install the following softwares:</br>
1. git</br>
2. openjdk-7-jdk</br>
3. python</br>
4. mysql</br>
</br>
And after that, run the following commands:</br>
sudo add-apt-repository ppa:eugenesan/ppa</br>
sudo apt-get update</br>
sudo apt-get install smartgithg</br>
</br>
End. Thanks.</br>
</body>
</html>
